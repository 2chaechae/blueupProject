<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reviewDao">

	<insert id="insertReview" parameterType="reviewvo" >
		INSERT INTO REVIEW(
			PRODUCT_NO,
			PRODUCT_NAME,
			USER_NO,
			PRODUCT_SIZE,
			STAR,
			REVIEW_TITLE,
			REVIEW_CONTENT,
			USER_ID,
			REVIEW_TIME,
			PRODUCT_COLOR
		) VALUES(
			#{product_no},
			#{product_name},
			#{user_no},
			#{product_size},
			#{star},
			#{review_title},
			#{review_content},
			#{user_id},
			now(),
			#{product_color}
		)
	</insert>
	 <!--리뷰 쓰기에  -->
	<!--<select id="getReviewList" parameterType="reviewvo" resultType="reviewvo">
		SELECT * FROM REVIEW WHERE USER_NO = #{user_no}
	</select> -->
	<!-- 리뷰 삭제 -->
	<delete id="deleteReview" parameterType="reviewvo">
		DELETE FROM REVIEW WHERE REVIEW_NO = #{review_no}
	</delete>
	
	
	<!-- 리뷰 수정을 위한 쿼리 -->
	<update id="updateReview" parameterType="reviewvo">
		UPDATE REVIEW   
		SET
	    STAR = #{star}, <!-- 별점 바꾸기 -->
		REVIEW_TITLE = #{review_title}, <!-- 리뷰 제목 -->
		REVIEW_CONTENT = #{review_content}  <!-- 리뷰 내용 -->
		<!-- 사진이랑 리뷰 작성 시간 -->
		WHERE REVIEW_NO = #{review_no}
	</update>
	
	<!-- 리뷰를 위한 한가지 상품정보가져오기 -->
	<select id="getProductInfoForReview" resultType="reviewvo" >
	  SELECT a.user_no, a.purchaseconfirm,
	  b.product_no, b.quantity, b.product_name, b.product_size, b.product_color, b.main_image
		FROM order_request as a JOIN order_detail as b
		on a.order_no = b.order_no WHERE a.user_no = #{user_no}
		AND b.order_status='구매확정' AND b.product_no = #{product_no} AND b.review_status='false';
	</select>
	
	<!-- 리뷰를 위한 사진 가져오기 -->
	<select id="getReivewPhoto" resultType="reviewvo" >
	select user_no from order_request and select * from review_photo
	 where user_no = #{user_no} AND product_no = #{product_no}; 
	</select>
	
	<!-- 작성가능한상품정보가져오기 -->
	<select id="getReviewproductList" resultType="reviewvo" >
	 SELECT a.user_no, a.purchaseconfirm,
	  b.product_no, b.quantity, b.product_name, b.product_size, b.product_color, b.main_image
		FROM order_request as a JOIN order_detail as b
		ON a.order_no = b.order_no 
		WHERE a.user_no = #{user_no}
	 	AND b.order_status='구매확정' AND b.review_status='false';
	</select> 
	
	<!-- 작성한 리뷰 가져오기 -->
	<select id="getReviewList" resultType="reviewvo" >
	<!--  SELECT * FROM REVIEW WHERE USER_NO = #{user_no} -->
	 
	SELECT  a.product_name, a.product_size, a.product_color, a.star, a.review_title, a.review_content,
		a.review_time, 
	   b.review_photo_no, b.photo1, b.photo2, b.photo3, b.photo4, b.photo5 
		FROM review as a LEFT OUTER JOIN review_photo as b
		ON a.review_no = b.review_no 
		WHERE a.user_no = #{user_no} AND a.product_no = b.product_no 
	<!--  SELECT a.user_no,b.review_status 
	 FROM review as a JOIN order_detail as b
	 ON a.user_no = b. order_no
	 WHERE a.user_no = #{user_no}
	 AND b.review_status='true'; -->
	</select>
	
	<!-- 수정을 위한 쿼리 -->
	<select id="modifyReview" resultType="reviewvo" >
	 SELECT * FROM REVIEW WHERE REVIEW_NO = #{review_no}

	</select>
</mapper>