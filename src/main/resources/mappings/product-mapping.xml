<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="productDao">

<!-- 상품 등록 -->
	<insert id="productRegistration">
		INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_PRICE,
		DISCOUNT, DELIVERY_FEE, CLOTHES_SIZE, COLOR,
		DISPLAY_STATUS, REGISTRATION_TIME, MAIN_IMAGE, PRODUCT_CONTENT, DISCOUNT_RATE,
		CATEGORY_NAME, DETAILED_CATEGORY_NAME)
		VALUES(
		#{product_name},
		#{price},
		#{discount},
		#{delivery_fee},
		#{clothes_size},
		#{color},
		#{display_status},<!--boolean -->
		now(),
		#{main_image},
		#{product_content},
		#{discount_rate},
		#{category_name},
		#{detailed_category_name}
		)
	</insert>

<!-- 상품 수정 -->
	<update id="productUpdate" parameterType="productvo">
		UPDATE PRODUCT SET
		PRODUCT_NAME = #{product_name},
		PRODUCT_PRICE = #{price},
		DISCOUNT = #{discount},
		DELIVERY_FEE = #{delivery_fee},
		CLOTHES_SIZE = #{clothes_size},
		COLOR = #{color},
		DISPLAY_STATUS = #{display_status},
		MAIN_IMAGE = #{main_image},
		PRODUCT_CONTENT = #{product_content},
		DISCOUNT_RATE = #{discount_rate},
		CATEGORY_NAME = #{category_name},
		DETAILED_CATEGORY_NAME = #{detailed_category_name}
		WHERE PRODUCT_NO = #{product_no}
	</update>
	
	<!-- 카테고리 기준 상품 조회 -->
	<select id="getProductListByCategory" resultType="productvo" parameterType="hashmap">
		SELECT a.main_image, a.product_no, a.product_price, a.product_name, a.category_name, a.detailed_category_name, b.wish_no, b.user_no
		FROM product as a LEFT OUTER JOIN wishlist as b 
		ON a.product_no = b.product_no and b.user_no = CAST(#{user_no} AS INTEGER)
		WHERE a.category_name = #{Selected.category_name} LIMIT #{perPageNum} OFFSET #{startRow}
	</select>
	
	<!-- 디테일 카테고리 기준 상품 조회 -->
	<select id="getProductListByDetailedCategory" resultType="productvo" parameterType="hashmap">
		SELECT a.main_image, a.product_no, a.product_price, a.product_name, a.category_name, a.detailed_category_name, b.wish_no, b.user_no
		FROM product as a LEFT OUTER JOIN wishlist as b 
		ON a.product_no = b.product_no and b.user_no = CAST(#{user_no} AS INTEGER)
		WHERE a.detailed_category_name = #{Selected.detailed_category_name} LIMIT #{perPageNum} OFFSET #{startRow}
	</select>
	
	<!--  전체 목록 수 조회(디테일) -->
	<select id="getCountProductDetail" resultType="int">
		SELECT COUNT(*) FROM PRODUCT WHERE detailed_category_name = #{Selected.detailed_category_name};
	</select>
	
	<!--  전체 목록 수 조회 -->
	<select id="getCountProduct" resultType="int">
		SELECT COUNT(*) FROM PRODUCT WHERE category_name = #{Selected.category_name};
	</select>

	<!-- 특정 회원의 wishList 상품 조회 -->
	<select id="getProductListBywishList" resultType="productvo" parameterType="String">
		SELECT a.main_image, a.product_no, a.product_price, a.product_name, b.wish_no, b.user_no
		FROM product as a RIGHT JOIN wishlist as b
		ON a.product_no = b.product_no 
		WHERE b.user_no = CAST(#{user_no} AS INTEGER);
	</select>
	
	<!-- 특정 상품 조회 -->
	<select id="getProduct" resultType="productvo" parameterType="productvo">
		SELECT * FROM PRODUCT
		WHERE
		PRODUCT_NO = #{product_no};
	</select>

	<!--  모든 상품 조회 -->
	<select id="getProductList" resultType="productvo">
		SELECT * FROM PRODUCT ORDER BY PRODUCT_NO DESC;
	</select>
	
	<!-- 검색어 기준 상품 조회 -->
	<select id="getProductListBySearch" parameterType="productvo" resultType="productvo">
		SELECT * FROM PRODUCT WHERE PRODUCT_NAME LIKE '%'||#{searchKeyword}||'%'
	</select>
</mapper>